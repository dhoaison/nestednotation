name: Deploy develop branch
on:
  push:
    branches:
      - develop
env:
  CI: true
  SSH_PORT: 22

jobs:
  send-noti:
      runs-on: ubuntu-latest
      name: Send noti to telegram on 
      steps:
        - name: Send Telegram Message
          uses: appleboy/telegram-action@master
          with:
            to: ${{ secrets.TELEGRAM_RECEIVER }}
            token: ${{ secrets.TELEGRAM_TOKEN }}
            message: "ðŸš€ðŸš€ðŸš€ Start deploy Nested Notation to dev  ðŸš€ðŸš€ðŸš€"
    
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Pull code and restart pm2
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.SSH_USERNAME }}
          port: 22
          password: ${{ secrets.SSH_PASSWORD }}
          script: |
            whoami
            pwd
            cd nestednotation
            git pull origin develop
            npm install
            pm2 start ecosystem.config.js -f

  send-noti-on-success:
     runs-on: ubuntu-latest
     steps:
       - name: Send Telegram Message
         uses: appleboy/telegram-action@master
         with:
           to: ${{ secrets.TELEGRAM_RECEIVER }}
           token: ${{ secrets.TELEGRAM_TOKEN }}
           message: "ðŸš€ðŸš€ðŸš€ Deploy Nested Notation to dev successfully ðŸš€ðŸš€ðŸš€"
      
        
